// DO NOT EDIT THIS FILE DIRECTLY. IT IS GENERATED BY 'make docs'.
:author: Jake Logemann
:idprefix:
:license-type: UNLICENSED
:toclevels: 1
:showtitle:
:toc-title: Contents
:toc: macro

ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

:terraform-docs: link:https://terraform-docs.io[terraform-docs]
:terraform: link:https://terraform.io[terraform]
:digitalocean: link:https://digitalocean.com[digitalocean]
:nixos: link:https://nixos.org[nixos]
:nix: link:https://nixos.org[nix]

a {terraform} module to manage {nixos} droplet(s)on {digitalocean}.

toc::[]

== Requirements

The following requirements are needed by this module:

- [[requirement_cloudinit]] <<requirement_cloudinit,cloudinit>> (~> 2.2)

- [[requirement_digitalocean]] <<requirement_digitalocean,digitalocean>> (~> 2.0)

== Providers

The following providers are used by this module:

- [[provider_cloudinit]] <<provider_cloudinit,cloudinit>> (2.2.0)

- [[provider_digitalocean]] <<provider_digitalocean,digitalocean>> (2.25.2)

== Resources

The following resources are used by this module:

- https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/droplet[digitalocean_droplet.main] (resource)
- https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/floating_ip[digitalocean_floating_ip.main] (resource)
- https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/volume[digitalocean_volume.extra] (resource)
- https://registry.terraform.io/providers/hashicorp/cloudinit/latest/docs/data-sources/config[cloudinit_config.user_data] (data source)
- https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/data-sources/ssh_keys[digitalocean_ssh_keys.all] (data source)
- https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/data-sources/vpc[digitalocean_vpc.main] (data source)

== Optional Inputs

The following input variables are optional (have default values):

=== [[input_droplet_size]] <<input_droplet_size,droplet_size>>

Description: which digitalocean droplet size should be used?

Type: `string`

Default: `"s-1vcpu-1gb-intel"`

=== [[input_droplet_tags]] <<input_droplet_tags,droplet_tags>>

Description: tags to apply to droplet.

Type: `list(string)`

Default:
[source,json]
----
[
  "nixos"
]
----

=== [[input_extra_volume]] <<input_extra_volume,extra_volume>>

Description: provision a Block Volume for host?

Type: `bool`

Default: `false`

=== [[input_extra_volume_size]] <<input_extra_volume_size,extra_volume_size>>

Description: how big should the extra volume be in GB?

Type: `number`

Default: `100`

=== [[input_floating_ip]] <<input_floating_ip,floating_ip>>

Description: reserve a floating IP droplet host?

Type: `bool`

Default: `true`

=== [[input_hostname]] <<input_hostname,hostname>>

Description: what name should be given to instance?

Type: `string`

Default: `"nixlet"`

=== [[input_image]] <<input_image,image>>

Description: change this at your own risk. it "just works" like this...

Type: `string`

Default: `"debian-11-x64"`

=== [[input_infect_script]] <<input_infect_script,infect_script>>

Description: where is the nixos-infect script?

Type: `string`

Default: `"https://raw.githubusercontent.com/elitak/nixos-infect/master/nixos-infect"`

=== [[input_nixos_channel]] <<input_nixos_channel,nixos_channel>>

Description: which nix channel should be used for managed hosts?

Type: `string`

Default: `"nixos-unstable"`

=== [[input_nixos_config]] <<input_nixos_config,nixos_config>>

Description: extra nixos config file, included in place of the default custom.nix in this module.

Type: `string`

Default: `""`

=== [[input_region]] <<input_region,region>>

Description: which digitalocean region should be used?

Type: `string`

Default: `"nyc3"`

=== [[input_ssh_key_ids]] <<input_ssh_key_ids,ssh_key_ids>>

Description: ssh key ids to grant root ssh access. does not create them. if unspecified, all currently available ssh keys will be used (within the  project containing this API token).

Type: `list(number)`

Default: `[]`

=== [[input_vpc_name]] <<input_vpc_name,vpc_name>>

Description: name of the VPC to target, if "default" will be appended with -$region

Type: `string`

Default: `"default"`

== Outputs

The following outputs are exported:

=== [[output_ipv4_address]] <<output_ipv4_address,ipv4_address>>

Description: public ipv4 address

=== [[output_ipv6_address]] <<output_ipv6_address,ipv6_address>>

Description: public ipv6 address

=== [[output_remote_log_file]] <<output_remote_log_file,remote_log_file>>

Description: logs from cloud-init will be in this path on the remote host. you can use something like `ssh root@<IP> tail -f <PATH>` to follow installation as it goes.

=== [[output_ssh_username]] <<output_ssh_username,ssh_username>>

Description: ssh username

== Development

1. install {terraform} (_optionally, {terraform-docs} is used to generate documentation, and {nix} is useful in several places_). run `./terraform.sh` to show available commands.

2. run `./terraform.sh init` to fetch required providers.

3. export `DIGITALOCEAN_TOKEN=...` in generated `.envrc` to set your credentials.

4. plan a deployment with `./terraform.sh plan`.

5. apply the plan with `./terraform.sh apply`.

6. clean up with `./terraform.sh destroy`.

== Appendix

* This documentation is automatically generated by {terraform-docs}. Update by running `./terraform.sh docs`.

// vim: ft=asciidoc
//