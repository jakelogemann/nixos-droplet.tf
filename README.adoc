// DO NOT EDIT THIS FILE DIRECTLY. IT IS GENERATED BY 'make docs'.
// vim: ft=asciidoc
:author: Jake Logemann
:idprefix:
:showtitle:
:title: cloud

ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

:terraform-docs: link:https://terraform-docs.io[terraform-docs]
:terraform: link:https://terraform.io[terraform]
:digitalocean: link:https://digitalocean.com[digitalocean]
:nixos: link:https://nixos.org[nixos]
:nix: link:https://nixos.org[nix]

a {terraform} module to create a {nixos} droplet on {digitalocean}.

== Providers

[cols="a,a",options="header,autowidth"]
|===
|Name |Version
|[[provider_cloudinit]] <<provider_cloudinit,cloudinit>> |2.2.0
|[[provider_digitalocean]] <<provider_digitalocean,digitalocean>> |2.25.2
|===

== Inputs

[cols="a,a,a",options="header,autowidth"]
|===
|Name |Description |Type
|[[input_droplet_size]] <<input_droplet_size,droplet_size>>
|which digitalocean droplet size should be used?
|`string`

|[[input_droplet_tags]] <<input_droplet_tags,droplet_tags>>
|tags to apply to droplet.
|`list(string)`

|[[input_extra_volume]] <<input_extra_volume,extra_volume>>
|provision a Block Volume for host?
|`bool`

|[[input_extra_volume_size]] <<input_extra_volume_size,extra_volume_size>>
|how big should the extra volume be in GB?
|`number`

|[[input_floating_ip]] <<input_floating_ip,floating_ip>>
|reserve a floating IP droplet host?
|`bool`

|[[input_hostname]] <<input_hostname,hostname>>
|what name should be given to instance?
|`string`

|[[input_image]] <<input_image,image>>
|change this at your own risk. it "just works" like this...
|`string`

|[[input_infect_script]] <<input_infect_script,infect_script>>
|where is the nixos-infect script?
|`string`

|[[input_nixos_channel]] <<input_nixos_channel,nixos_channel>>
|which nix channel should be used for managed hosts?
|`string`

|[[input_nixos_config]] <<input_nixos_config,nixos_config>>
|extra nixos config file, included in place of the default custom.nix in this module.
|`string`

|[[input_region]] <<input_region,region>>
|which digitalocean region should be used?
|`string`

|[[input_ssh_key_ids]] <<input_ssh_key_ids,ssh_key_ids>>
|ssh key ids to grant root ssh access. does not create them. if unspecified, all currently available ssh keys will be used (within the  project containing this API token).
|`list(number)`

|[[input_vpc_name]] <<input_vpc_name,vpc_name>>
|name of the VPC to target, if "default" will be appended with -$region
|`string`

|===

== Outputs

[cols="a,a",options="header,autowidth"]
|===
|Name |Description
|[[output_ipv4_address]] <<output_ipv4_address,ipv4_address>> |public ipv4 address
|[[output_ipv6_address]] <<output_ipv6_address,ipv6_address>> |public ipv6 address
|[[output_remote_log_file]] <<output_remote_log_file,remote_log_file>> |logs from cloud-init will be in this path on the remote host. you can use something like `ssh root@<IP> tail -f <PATH>` to follow installation as it goes.
|[[output_ssh_username]] <<output_ssh_username,ssh_username>> |ssh username
|===

== Getting Started

1. install {terraform} and {terraform-docs}. run `./terraform.sh` to show available commands.

2. run `./terraform.sh init` to fetch required providers.

3. export `DIGITALOCEAN_TOKEN=...` (directly, or via the example `.envrc`) to set your credentials.

4. plan a deployment with `./terraform.sh plan`.

5. apply the plan with `./terraform.sh apply`.

6. ssh to your host and enjoy! allow ~5-10 minutes to provision, try not to modify anything while its still provisioning (or just `tail -f /var/log/cloud-init-output.log`).

7. clean up everything with `./terraform.sh destroy`.